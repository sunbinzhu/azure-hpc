{
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.1.2-preview",
  "parameters": {
    "resourceTypes": [
      "Microsoft.Compute/virtualMachines",
      "Microsoft.ContainerInstance/containerGroups",
      "Microsoft.Storage/storageAccounts",
      "Microsoft.Web/serverfarms",
      "Microsoft.Web/sites"
    ],
    "basics": [
      {
        "name": "portalDnsNameLabelText",
        "type": "Microsoft.Common.TextBlock",
        "options": {
          "text": "Specify a globally unique DNS name label for your Azure Cluster Management (ACM) portal."
        }
      },
      {
        "name": "portalDnsNameLabel",
        "type": "Microsoft.Common.TextBox",
        "label": "DNS name label for ACM portal",
        "toolTip": "The DNS name label for ACM portal. It must be globally unique. Visit the portal at 'https://&lt;DnsNameLabel&gt;.azurewebsites.net' after the deployment",
        "defaultValue": "",
        "constraints": {
          "required": true,
          "regex": "^[a-z][a-z0-9]{4,62}$",
          "validationMessage": "The DNS name label must be between 5 and 63 characters long. It can contain only lowercase letters, numbers, and hyphens, and must start with a letter and end with a letter or a number."
        }
      }
    ],
    "steps": [
      {
        "name": "portalSetting",
        "label": "ACM Portal Settings",
        "visible": true,
        "subLabel": {
          "preValidation": "Configure ACM Portal",
          "postValidation": "Done"
        },
        "bladeTitle": "ACM portal settings",
        "elements": [
          {
            "name": "frontend",
            "type": "Microsoft.Common.Section",
            "label": "Frontend Settings",
            "elements": [
              {
                "name": "acmWebAppText",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "An Azure Web App will be created for your ACM portal. Select a pricing tier for the App Service plan which will be used by the portal.",
                  "link": {
                    "label": "Learn more about App Service Plan",
                    "uri": "https://go.microsoft.com/fwlink/?linkid=2058350"
                  }
                }
              },
              {
                "name": "acmAppPriceTier",
                "type": "Microsoft.Common.DropDown",
                "label": "Pricing tier for ACM portal",
                "defaultValue": "S1 Standard (100 ACU, 1.75 GB)",
                "toolTip": "An Azure Web App will be created for your ACM portal, select the pricing tier for the App Service Plan",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "S1 Standard (100 ACU, 1.75 GB)",
                      "value": "S1 Standard"
                    },
                    {
                      "label": "S2 Standard (200 ACU, 3.50 GB)",
                      "value": "S2 Standard"
                    },
                    {
                      "label": "S3 Standard (400 ACU, 7 GB)",
                      "value": "S3 Standard"
                    },
                    {
                      "label": "P1V2 PremiumV2 (210 ACU, 3.5 GB)",
                      "value": "P1v2 PremiumV2"
                    },
                    {
                      "label": "P2V2 PremiumV2 (420 ACU, 7 GB)",
                      "value": "P2v2 PremiumV2"
                    },
                    {
                      "label": "P3V2 PremiumV2 (840 ACU, 14 GB)",
                      "value": "P3v2 PremiumV2"
                    }
                  ]
                }
              },
              {
                "name": "acmWebAppAuthText",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Select an authentication option for the ACM portal. If 'Configure later' is selected, you must manually configure the authentication setting of the Portal Web App before you can access it.",
                  "link": {
                    "label": "Learn more about ACM authentication",
                    "uri": "https://go.microsoft.com/fwlink/?linkid=2054782"
                  }
                }
              },
              {
                "name": "authOption",
                "type": "Microsoft.Common.DropDown",
                "label": "Authentication Option",
                "defaultValue": "Configure later",
                "toolTip": "The authentication option for the ACM portal.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "No Authentication",
                      "value": "anonymous"
                    },
                    {
                      "label": "Existing AAD application",
                      "value": "existing"
                    },
                    {
                      "label": "Configure later",
                      "value": "manual"
                    }
                  ]
                }
              },
              {
                "name": "authenMethodWarning",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[equals(steps('portalSetting').frontend.authOption, 'anonymous')]",
                "options": {
                  "icon": "Warning",
                  "text": "Anonymous access will be enabled on the ACM portal. Anyone can access your cluster without login."
                }
              },
              {
                "name": "authAadApplicationId",
                "type": "Microsoft.Common.TextBox",
                "label": "AAD application Id",
                "toolTip": "The application Id for an existing AAD application which will be used to authenticate the login of ACM portal",
                "visible": "[equals(steps('portalSetting').frontend.authOption, 'existing')]",
                "constraints": {
                  "required": true,
                  "regex": "^[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}$",
                  "validationMessage": "Must be a Guid."
                }
              }
            ],
            "visible": true
          },
          {
            "name": "backend",
            "type": "Microsoft.Common.Section",
            "label": "Backend Settings",
            "elements": [
              {
                "name": "acmBackendText",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Azure Container Instances will be created to run the ACM backend services. Specify the CPU and memory resources for the container group according to the reginal resource limits.",
                  "link": {
                    "label": "Regional resource limits",
                    "uri": "https://go.microsoft.com/fwlink/?linkid=2055350"
                  }
                }
              },
              {
                "name": "acmBackendCpuCores",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of CPU cores",
                "defaultValue": "2",
                "toolTip": "Specify the number of CPU cores for the container group. Click 'Regional resource limits' above to learn the CPU limit for the current location.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "2",
                      "value": {
                        "jobMonitor": "0.7",
                        "taskDispatcher": "0.6",
                        "dashBoard": "0.7"
                      }
                    },
                    {
                      "label": "3",
                      "value": {
                        "jobMonitor": "1",
                        "taskDispatcher": "1",
                        "dashBoard": "1"
                      }
                    },
                    {
                      "label": "4",
                      "value": {
                        "jobMonitor": "1.4",
                        "taskDispatcher": "1.2",
                        "dashBoard": "1.4"
                      }
                    }
                  ]
                }
              },
              {
                "name": "acmBackendMemory",
                "type": "Microsoft.Common.DropDown",
                "label": "Memory (GB)",
                "defaultValue": "3.5",
                "toolTip": "Specify the memory for the container group. Click 'Regional resource limits' above to learn the memory limit for the current location.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "3.5",
                      "value": {
                        "jobMonitor": "1.2",
                        "taskDispatcher": "1.1",
                        "dashBoard": "1.2"
                      }
                    },
                    {
                      "label": "4.5",
                      "value": {
                        "jobMonitor": "1.5",
                        "taskDispatcher": "1.5",
                        "dashBoard": "1.5"
                      }
                    },
                    {
                      "label": "6",
                      "value": {
                        "jobMonitor": "2",
                        "taskDispatcher": "2",
                        "dashBoard": "2"
                      }
                    }
                  ]
                }
              }
            ],
            "visible": true
          },
          {
            "name": "acmStorageAccount",
            "type": "Microsoft.Storage.StorageAccountSelector",
            "label": "Storage account for ACM",
            "toolTip": "A storage account is required for the ACM portal.",
            "defaultValue": {
              "name": "[concat('hpcacmstg', string(rand(1, 999999999)))]",
              "type": "Standard_LRS"
            },
            "constraints": {
              "allowedTypes": [
                "Standard_LRS",
                "Standard_GRS",
                "Standard_ZRS"
              ]
            },
            "options": {
              "hideExisting": false
            },
            "visible": true
          }
        ]
      },
      {
        "name": "clusterSetting",
        "label": "HPC Cluster settings",
        "subLabel": {
          "preValidation": "Configure HPC Cluster",
          "postValidation": "Done"
        },
        "bladeTitle": "HPC Cluster settings",
        "elements": [
          {
            "name": "hpcClusterText",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "You can create a new HPC cluster with 'Slurm' or 'PBSPro' scheduler and automatically register it to the ACM portal now, or manually register your existing HPC cluster later.",
              "link": {
                "label": "Learn more about cluster registration",
                "uri": "https://go.microsoft.com/fwlink/?linkid=2055058"
              }
            }
          },
          {
            "name": "createCluster",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Create new HPC cluster",
            "defaultValue": "No",
            "toolTip": "Specify whether you want to create a new HPC cluster",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": "Yes"
                },
                {
                  "label": "No",
                  "value": "No"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "clusterBasic",
            "type": "Microsoft.Common.Section",
            "label": "",
            "elements": [
              {
                "name": "schedulerType",
                "type": "Microsoft.Common.DropDown",
                "label": "HPC Scheduler",
                "defaultValue": "Slurm 18.08",
                "toolTip": "The HPC scheduler to be installed.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Slurm 15.08",
                      "value": "Slurm_15.08.13-1"
                    },
                    {
                      "label": "Slurm 16.05",
                      "value": "Slurm_16.05.11-1"
                    },
                    {
                      "label": "Slurm 17.02",
                      "value": "Slurm_17.02.11-1"
                    },
                    {
                      "label": "Slurm 17.11",
                      "value": "Slurm_17.11.12-1"
                    },
                    {
                      "label": "Slurm 18.08",
                      "value": "Slurm_18.08.4-1"
                    },
                    {
                      "label": "PBSPro 14.1",
                      "value": "PBSPro_14.1.0"
                    },
                    {
                      "label": "PBSPro 18.1",
                      "value": "PBSPro_18.1.3"
                    }
                  ]
                }
              },
              {
                "name": "clusterNodeImage",
                "type": "Microsoft.Common.DropDown",
                "label": "VM image",
                "defaultValue": "CentOS-based 7.3",
                "toolTip": "The VM image for the HPC cluster node virtual machines. If you select an 'HPC' image, make sure you select RDMA capable VM sizes for head node and worker nodes.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "CentOS-based 7.1",
                      "value": "OpenLogic/CentOS/7.1"
                    },
                    {
                      "label": "CentOS-based 7.2",
                      "value": "OpenLogic/CentOS/7.2"
                    },
                    {
                      "label": "CentOS-based 7.3",
                      "value": "OpenLogic/CentOS/7.3"
                    },
                    {
                      "label": "CentOS-based 7.4",
                      "value": "OpenLogic/CentOS/7.4"
                    },
                    {
                      "label": "CentOS-based 7.5",
                      "value": "OpenLogic/CentOS/7.5"
                    },
                    {
                      "label": "CentOS-based 7.1 HPC",
                      "value": "OpenLogic/CentOS-HPC/7.1:RDMA"
                    },
                    {
                      "label": "CentOS-based 7.3 HPC",
                      "value": "OpenLogic/CentOS-HPC/7.3:RDMA"
                    },
                    {
                      "label": "CentOS-based 7.4 HPC",
                      "value": "OpenLogic/CentOS-HPC/7.4:RDMA"
                    },
                    {
                      "label": "Other CentOS 7.x Image",
                      "value": "other"
                    }
                  ]
                }
              },
              {
                "name": "otherClusterNodeImage",
                "type": "Microsoft.Common.TextBox",
                "label": "Other VM Image",
                "toolTip": "Specify the CentOS 7.x VM image in the format of 'ImagePublisher/ImageOffer/ImageSku' for Marketplace image or 'ResourceGroupName/ImageName' for private image.",
                "visible": "[equals(steps('clusterSetting').clusterBasic.clusterNodeImage, 'other')]",
                "constraints": {
                  "required": true,
                  "regex": "^[^/]+/[^/]+(/[^/]+)?$",
                  "validationMessage": "'ImagePublisher/ImageOffer/ImageSku' for Marketplace image or 'ResourceGroupName/ImageName' for private image."
                }
              },
              {
                "name": "clusterNodeImageInfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[contains(steps('clusterSetting').clusterBasic.clusterNodeImage, ':RDMA')]",
                "options": {
                  "icon": "Info",
                  "text": "The VM image requires RDMA capable VM size for all nodes."
                }
              },
              {
                "name": "adminUserName",
                "type": "Microsoft.Compute.UserNameTextBox",
                "label": "Administrator User name",
                "defaultValue": "azureuser",
                "toolTip": "Administrator user name for the virtual machines.",
                "constraints": {
                  "required": true,
                  "regex": "^[a-z0-9A-Z]{1,30}$",
                  "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                },
                "osPlatform": "Linux"
              },
              {
                "name": "adminPassword",
                "type": "Microsoft.Compute.CredentialsCombo",
                "label": {
                  "authenticationType": "Authentication type",
                  "password": "Password",
                  "confirmPassword": "Confirm password"
                },
                "toolTip": {
                  "password": "The password of administrator user."
                },
                "osPlatform": "Linux",
                "constraints": {
                  "required": true
                }
              },
              {
                "name": "headNodePublicIP",
                "type": "Microsoft.Network.PublicIpAddressCombo",
                "label": {
                  "publicIpAddress": "Public IP address for head node",
                  "domainNameLabel": "DNS name label for head node"
                },
                "toolTip": {
                  "publicIpAddress": "The public IP address for the head node.",
                  "domainNameLabel": "If specified, an \"A record\" that starts with the specified label and resolves to the public IP address for the head node will be registered with the Azure-provided DNS servers. Example: mylabel.westus.cloudapp.azure.com."
                },
                "defaultValue": {
                  "publicIpAddressName": "[concat('hpcpubip', string(rand(1, 999999999)))]"
                },
                "options": {
                  "hideNone": true,
                  "hideDomainNameLabel": false
                }
              },
              {
                "name": "headNodeName",
                "type": "Microsoft.Common.TextBox",
                "label": "Head node name",
                "toolTip": "The virtual machine name for the head node",
                "defaultValue": "master",
                "constraints": {
                  "required": true,
                  "regex": "^[a-zA-Z][a-zA-Z0-9-]{1,11}$",
                  "validationMessage": "Must be no more than 12 characters, begin with a letter, and contain only letters, numbers and hyphens"
                }
              },
              {
                "name": "headNodeVMSize",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Head node VM Size",
                "toolTip": "VM Size for the head node",
                "recommendedSizes": [
                  "Standard_D8s_v3",
                  "Standard_DS4_v2",
                  "Standard_F8s",
                  "Standard_D4s_v3",
                  "Standard_DS3_v2",
                  "Standard_H16r",
                  "Standard_H8",
                  "Standard_H16",
                  "Standard_DS4"
                ],
                "constraints": {
                  "excludedSizes": [
                    "Basic_A0",
                    "Basic_A1",
                    "Basic_A2",
                    "Basic_A3",
                    "Basic_A4",
                    "Standard_A0",
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A5",
                    "Standard_A1_v2",
                    "Standard_A2_v2",
                    "Standard_A2m_v2",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D11",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D11_v2",
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS11",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS11_v2",
                    "Standard_F1",
                    "Standard_F2",
                    "Standard_F1s",
                    "Standard_F2s",
                    "Standard_G1",
                    "Standard_GS1"
                  ]
                },
                "osPlatform": "Linux",
                "count": 1
              },
              {
                "name": "headNodeOsDiskType",
                "type": "Microsoft.Common.DropDown",
                "label": "OS disk type for head node",
                "defaultValue": "Premium SSD",
                "toolTip": "Premium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. To use Premium SSD disks, you must choose VM Size with premium storage support. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Standard HDD",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "Standard SSD",
                      "value": "StandardSSD_LRS"
                    },
                    {
                      "label": "Premium SSD",
                      "value": "Premium_LRS"
                    }
                  ]
                }
              },
              {
                "name": "headNodeOsDiskTypeWarning",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[and(not(contains(toLower(replace(string(steps('clusterSetting').clusterBasic.headNodeVMSize), 'Standard_', '')), 's')), equals(steps('clusterSetting').clusterBasic.headNodeOsDiskType, 'Premium_LRS'))]",
                "options": {
                  "icon": "Error",
                  "text": "The VM size for head node does not support Premium SSD disk."
                }
              },
              {
                "name": "workerNodeNamePrefix",
                "type": "Microsoft.Common.TextBox",
                "label": "Worker node name prefix",
                "toolTip": "The name prefix of the worker nodes. For example, if 'worker' is specified, the worker node names will be 'worker0', 'worker1', ...",
                "defaultValue": "worker",
                "constraints": {
                  "required": true,
                  "regex": "^[a-zA-Z][a-zA-Z0-9-]{1,11}$",
                  "validationMessage": "Must be no more than 12 characters, begin with a letter, and contain only letters, numbers and hyphens"
                }
              },
              {
                "name": "workerNodeCount",
                "type": "Microsoft.Common.TextBox",
                "label": "Number of worker nodes",
                "toolTip": "The number of worker nodes to be created",
                "defaultValue": "8",
                "constraints": {
                  "required": true,
                  "regex": "^[1-9][0-9]{0,2}$",
                  "validationMessage": "Must be an integer between 1 and 999."
                }
              },
              {
                "name": "workerNodeVMSize",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Worker node VM Size",
                "toolTip": "VM size for the worker nodes",
                "recommendedSizes": [
                  "Standard_D8s_v3",
                  "Standard_DS4_v2",
                  "Standard_F8s",
                  "Standard_D4s_v3",
                  "Standard_DS3_v2",
                  "Standard_H16r",
                  "Standard_H8",
                  "Standard_H16",
                  "Standard_DS4"
                ],
                "constraints": {
                  "excludedSizes": [
                    "Basic_A0",
                    "Basic_A1",
                    "Basic_A2",
                    "Basic_A3",
                    "Basic_A4",
                    "Standard_A0",
                    "Standard_A1"
                  ]
                },
                "osPlatform": "Linux",
                "count": "[steps('clusterSetting').clusterBasic.workerNodeCount]"
              },
              {
                "name": "workerNodeOsDiskType",
                "type": "Microsoft.Common.DropDown",
                "label": "OS disk type for worker nodes",
                "defaultValue": "Premium SSD",
                "toolTip": "Premium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. To use Premium SSD disks, you must choose VM Size with premium storage support. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Standard HDD",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "Standard SSD",
                      "value": "StandardSSD_LRS"
                    },
                    {
                      "label": "Premium SSD",
                      "value": "Premium_LRS"
                    }
                  ]
                }
              },
              {
                "name": "workerNodeOsDiskTypeWarning",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[and(not(contains(toLower(replace(string(steps('clusterSetting').clusterBasic.workerNodeVMSize), 'Standard_', '')), 's')), equals(steps('clusterSetting').clusterBasic.workerNodeOsDiskType, 'Premium_LRS'))]",
                "options": {
                  "icon": "Error",
                  "text": "The VM size for worker nodes does not support Premium SSD disk."
                }
              },
              {
                "name": "setAdvanced",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Specify advanced settings",
                "defaultValue": "No",
                "toolTip": "Specify advanced settings",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Yes",
                      "value": "Yes"
                    },
                    {
                      "label": "No",
                      "value": "No"
                    }
                  ],
                  "required": true
                },
                "visible": true
              }
            ],
            "visible": "[equals(steps('clusterSetting').createCluster, 'Yes')]"
          },
          {
            "name": "dataDisks",
            "type": "Microsoft.Common.Section",
            "label": "Data Disks",
            "elements": [
              {
                "name": "dataDiskText",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "You can attach a number of data disks for head node and worker nodes.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://go.microsoft.com/fwlink/?linkid=2058425"
                  }
                }
              },
              {
                "name": "clusterFilesystem",
                "type": "Microsoft.Common.DropDown",
                "label": "Cluster File System",
                "defaultValue": "None",
                "toolTip": "Specify whether you want to create a cluster file system with BeeGFS (https://www.beegfs.io) across the HPC cluster nodes. If you choose 'BeeGFS', at least 2 data disks are required for each node; the head node will act as the management and metadata server, the worker nodes will act as the storage servers.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "None",
                      "value": "None:None"
                    },
                    {
                      "label": "BeeGFS",
                      "value": "BeeGFS:Storage"
                    }
                  ]
                }
              },
              {
                "name": "text1",
                "type": "Microsoft.Common.TextBlock",
                "visible": "[equals(coalesce(steps('clusterSetting').dataDisks.clusterFilesystem, ''), 'BeeGFS:Storage')]",
                "options": {
                  "text": "You shall specify at least 2 data disks for the head node and each worker node. The head node will act as Management and Metadata Server, the worker nodes will act as Storage Servers.",
                  "link": {
                    "label": "More about BeeGFS",
                    "uri": "https://www.beegfs.io"
                  }
                }
              },
              {
                "name": "headNodeDataDiskSize",
                "type": "Microsoft.Common.DropDown",
                "label": "Size of head node data disk(GB)",
                "defaultValue": "128",
                "toolTip": "The size in GB for each data disk attached to the head node.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "32",
                      "value": 32
                    },
                    {
                      "label": "64",
                      "value": 64
                    },
                    {
                      "label": "128",
                      "value": 128
                    },
                    {
                      "label": "256",
                      "value": 256
                    },
                    {
                      "label": "512",
                      "value": 512
                    },
                    {
                      "label": "1024",
                      "value": 1024
                    },
                    {
                      "label": "2048",
                      "value": 2048
                    },
                    {
                      "label": "4096",
                      "value": 4096
                    }
                  ]
                }
              },
              {
                "name": "headNodeDataDiskCount",
                "type": "Microsoft.Common.DropDown",
                "label": "Data disk number for head node",
                "defaultValue": "0",
                "toolTip": "The number of data disks attached to the head node. Do not specify a number which exceeds the maximum data disk number of the head node VM Size.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0",
                      "value": 0
                    },
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "4",
                      "value": 4
                    },
                    {
                      "label": "8",
                      "value": 8
                    },
                    {
                      "label": "16",
                      "value": 16
                    }
                  ]
                }
              },
              {
                "name": "headNodeDataDiskType",
                "type": "Microsoft.Common.DropDown",
                "label": "Data disk type for head node",
                "defaultValue": "Premium SSD",
                "toolTip": "Premium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. To use Premium SSD disks, you must choose VM Size with premium storage support. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Standard HDD",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "Standard SSD",
                      "value": "StandardSSD_LRS"
                    },
                    {
                      "label": "Premium SSD",
                      "value": "Premium_LRS"
                    }
                  ]
                }
              },
              {
                "name": "headNodeDataDiskTypeWarning",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[and(not(contains(toLower(replace(coalesce(steps('clusterSetting').clusterBasic.headNodeVMSize, ''), 'Standard_', '')), 's')), equals(steps('clusterSetting').dataDisks.headNodeDataDiskType, 'Premium_LRS'))]",
                "options": {
                  "icon": "Error",
                  "text": "The VM size for head node does not support Premium SSD disk.."
                }
              },
              {
                "name": "workerNodeDataDiskSize",
                "type": "Microsoft.Common.DropDown",
                "label": "Size of worker node data disk(GB)",
                "defaultValue": "128",
                "toolTip": "The size in GB for each data disk attached to worker nodes.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "32",
                      "value": 32
                    },
                    {
                      "label": "64",
                      "value": 64
                    },
                    {
                      "label": "128",
                      "value": 128
                    },
                    {
                      "label": "256",
                      "value": 256
                    },
                    {
                      "label": "512",
                      "value": 512
                    },
                    {
                      "label": "1024",
                      "value": 1024
                    },
                    {
                      "label": "2048",
                      "value": 2048
                    },
                    {
                      "label": "4096",
                      "value": 4096
                    }
                  ]
                }
              },
              {
                "name": "workerNodeDataDiskCount",
                "type": "Microsoft.Common.DropDown",
                "label": "Data disk number for worker node",
                "defaultValue": "0",
                "toolTip": "The number of data disks attached to each worker node. Do not specify a number which exceeds the maximum data disk number of the worker node VM Size.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0",
                      "value": 0
                    },
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "4",
                      "value": 4
                    },
                    {
                      "label": "8",
                      "value": 8
                    },
                    {
                      "label": "16",
                      "value": 16
                    }
                  ]
                }
              },
              {
                "name": "workerNodeDataDiskType",
                "type": "Microsoft.Common.DropDown",
                "label": "Data disk type for worker node",
                "defaultValue": "Standard HDD",
                "toolTip": "Premium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. To use Premium SSD disks, you must choose VM Size with premium storage support. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Standard HDD",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "Standard SSD",
                      "value": "StandardSSD_LRS"
                    },
                    {
                      "label": "Premium SSD",
                      "value": "Premium_LRS"
                    }
                  ]
                }
              },
              {
                "name": "workerNodeDataDiskTypeWarning",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[and(not(contains(toLower(replace(coalesce(steps('clusterSetting').clusterBasic.workerNodeVMSize, ''), 'Standard_', '')), 's')), equals(steps('clusterSetting').dataDisks.workerNodeDataDiskType, 'Premium_LRS'))]",
                "options": {
                  "icon": "Error",
                  "text": "The VM size for worker nodes does not support Premium SSD disk."
                }
              }
            ],
            "visible": "[and(equals(steps('clusterSetting').createCluster, 'Yes'), equals(steps('clusterSetting').clusterBasic.setAdvanced, 'Yes'))]"
          }
        ]
      }
    ],
    "outputs": {
      "portalDnsNameLabel": "[basics('portalDnsNameLabel')]",
      "appServicePlanPricingTier": "[steps('portalSetting').frontend.acmAppPriceTier]",
      "portalAnonymousAccess": "[equals(steps('portalSetting').frontend.authOption, 'anonymous')]",
      "aadAuthApplicationId": "[steps('portalSetting').frontend.authAadApplicationId]",
      "storageAccountType": "[steps('portalSetting').acmStorageAccount.type]",
      "storageAccountName": "[steps('portalSetting').acmStorageAccount.name]",
      "storageAccountResourceGroup": "[steps('portalSetting').acmStorageAccount.resourceGroup]",
      "newOrExistingStorageAccount": "[steps('portalSetting').acmStorageAccount.newOrExisting]",
      "frontendImageName": "mcr.microsoft.com/hpcpack/hpcacm:frontend",
      "jobMonitorImageName": "mcr.microsoft.com/hpcpack/hpcacm:jobmonitor",
      "dashboardImageName": "mcr.microsoft.com/hpcpack/hpcacm:dashboard",
      "taskDispatcherImageName": "mcr.microsoft.com/hpcpack/hpcacm:taskdispatcher",
      "jobMonitorCpuCores": "[steps('portalSetting').backend.acmBackendCpuCores.jobMonitor]",
      "jobMonitorMemoryInGb": "[steps('portalSetting').backend.acmBackendMemory.jobMonitor]",
      "taskDispatcherCpuCores": "[steps('portalSetting').backend.acmBackendCpuCores.taskDispatcher]",
      "taskDispatcherMemoryInGb": "[steps('portalSetting').backend.acmBackendMemory.jobMonitor]",
      "dashboardCpuCores": "[steps('portalSetting').backend.acmBackendCpuCores.dashBoard]",
      "dashboardMemoryInGb": "[steps('portalSetting').backend.acmBackendMemory.jobMonitor]",
      "scheduler": "[steps('clusterSetting').clusterBasic.schedulerType]",
      "adminUserName": "[steps('clusterSetting').clusterBasic.adminUserName]",
      "adminPassword": "[steps('clusterSetting').clusterBasic.adminPassword.password]",
      "adminSshPublicKey": "[steps('clusterSetting').clusterBasic.adminPassword.sshPublicKey]",
      "hpcNodeImage": "[coalesce(steps('clusterSetting').clusterBasic.otherClusterNodeImage, steps('clusterSetting').clusterBasic.clusterNodeImage)]",
      "headNodeName": "[steps('clusterSetting').clusterBasic.headNodeName]",
      "headNodeSize": "[steps('clusterSetting').clusterBasic.headNodeVMSize]",
      "headNodeOsDiskType": "[steps('clusterSetting').clusterBasic.headNodeOsDiskType]",
      "publicIPCreateOption": "[steps('clusterSetting').clusterBasic.headNodePublicIP.newOrExistingOrNone]",
      "publicIPResourceGroupName": "[steps('clusterSetting').clusterBasic.headNodePublicIP.resourceGroup]",
      "publicIPName": "[steps('clusterSetting').clusterBasic.headNodePublicIP.name]",
      "publicIPSku": "[steps('clusterSetting').clusterBasic.headNodePublicIP.sku]",
      "publicIPDNSNameLabel": "[steps('clusterSetting').clusterBasic.headNodePublicIP.domainNameLabel]",
      "publicIPAllocationMethod": "[steps('clusterSetting').clusterBasic.headNodePublicIP.publicIPAllocationMethod]",
      "workerNodeNamePrefix": "[steps('clusterSetting').clusterBasic.workerNodeNamePrefix]",
      "workerNodeSize": "[steps('clusterSetting').clusterBasic.workerNodeVMSize]",
      "workerNodeCount": "[int(coalesce(steps('clusterSetting').clusterBasic.workerNodeCount, '1'))]",
      "workerNodeOsDiskType": "[steps('clusterSetting').clusterBasic.workerNodeOsDiskType]",
      "clusterFilesystem": "[steps('clusterSetting').dataDisks.clusterFilesystem]",
      "headNodeDataDiskSize": "[steps('clusterSetting').dataDisks.headNodeDataDiskSize]",
      "headNodeDataDiskType": "[steps('clusterSetting').dataDisks.headNodeDataDiskType]",
      "headNodeDataDiskCount": "[steps('clusterSetting').dataDisks.headNodeDataDiskCount]",
      "workerNodeDataDiskSize": "[steps('clusterSetting').dataDisks.workerNodeDataDiskSize]",
      "workerNodeDataDiskCount": "[steps('clusterSetting').dataDisks.workerNodeDataDiskCount]",
      "workerNodeDataDiskType": "[steps('clusterSetting').dataDisks.workerNodeDataDiskType]",
      "location": "[location()]"
    }
  }
}
